<nz-page-header
    [nzBackIcon]="'arrow-left'"
>
    <nz-page-header-title><div contenteditable>Безымянный</div></nz-page-header-title>
    <nz-page-header-subtitle>Информационное дополнение</nz-page-header-subtitle>
    <nz-page-header-extra>
        <nz-space>
            <button *nzSpaceItem nz-button>
                <span nz-icon [nzType]="'expand'" nzTheme="outline"></span>
            </button>
            <button *nzSpaceItem nz-button nzType="primary">
                <span nz-icon nzType="save"></span>
                Сохранить
            </button>
            <div *nzSpaceItem>
                <button
                    nz-button
                    nzNoAnimation
                    nz-dropdown
                    [nzDropdownMenu]="menu"
                    nzPlacement="bottomRight"
                    style="padding: 0"
                >
                    <span nz-icon nzType="more" nzTheme="outline" style="font-size: 18px; vertical-align: top;"></span> 
                </button>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                    <ul nz-menu>
                        <li nz-menu-item nzWarning>
                            <span nz-icon nzType="reload"></span>
                            Сбросить к началу
                        </li>
                        <li nz-menu-item nzDanger>
                            <span nz-icon nzType="delete"></span>
                            Удалить
                        </li>
                    </ul>
                </nz-dropdown-menu>
            </div>
        </nz-space>
    </nz-page-header-extra>
</nz-page-header>
<nz-content>
    <div
        class="bi-metalayer"
    >
        <div class="inner-content bi-metalayer-sources">
            <div class="bi-sources-header">
                <strong><span nz-icon nzType="database" nzTheme="outline"></span> Источники</strong>
            </div>
            <div class="bi-sources-select">
                <nz-select nzShowSearch nzPlaceHolder="Выберите источник" [nzSize]="'small'">
                    <nz-option nzLabel="Название источника данных 1" nzValue="1"></nz-option>
                    <nz-option nzLabel="Название источника данных 2" nzValue="2"></nz-option>
                    <nz-option nzLabel="Название источника данных 3" nzValue="3"></nz-option>
                </nz-select>
            </div>
            <div class="bi-sources">
                <div class="bi-sources-search">
                    <nz-input-group [nzSuffix]="suffixIconSearch" nzSize="small">
                        <input type="text" nz-input placeholder="Поиск в слоях"/>
                    </nz-input-group>
                    <ng-template #suffixIconSearch nzSize="small">
                        <span nz-icon nzType="search"></span>
                    </ng-template>
                </div>
                <div class="bi-sources-list">
                    <nz-tree [nzData]="nodes" nzShowLine (nzClick)="nzEvent($event)"></nz-tree>
                </div>
            </div>
        </div>

        <div class="inner-content bi-metalayer-table">
            <nz-space
                [ngStyle]="{
                    'width': '100%',
                    'justify-content': 'space-between'
                }"
            >
                <strong *nzSpaceItem>
                    Название таблицы
                </strong>
                <button *nzSpaceItem nz-button nzType="text" nzSize="small">
                    <span nz-icon nzType="close" nzTheme="outline"></span>
                </button>
            </nz-space>
            <nz-divider [ngStyle]="{'margin': '8px 0'}"></nz-divider>
            <div>
                Место для таблицы
            </div>
        </div>
        <div class="inner-content bi-metalayer-semantic">
            <div class="bi-semantic-header">
                <strong><span nz-icon nzType="container" nzTheme="outline"></span> Семантические слои</strong>
                <!-- <button
                    nz-button
                    nzNoAnimation
                    nz-dropdown
                    [nzDropdownMenu]="menu"
                    nzPlacement="bottomRight"
                    nzTrigger="click"
                    nzType="text"
                    nzSize="small"
                >
                    <span nz-icon nzType="plus" nzTheme="outline"></span> 
                </button>
                <nz-dropdown-menu #menu="nzDropdownMenu">
                    <nz-card
                        nz-menu
                        style="width:256px;"
                        nzSize="small"
                    >
                        <nz-form-control>
                            <nz-form-label nzFor="layer-name" nzSize="small"><strong>Название</strong></nz-form-label>
                            <input id="layer-name" nz-input placeholder="Название слоя" nzSize="small"/>
                        </nz-form-control>
                        <nz-divider [ngStyle]="{'margin': '8px 0'}"></nz-divider>
                        <div
                            nz-flex
                            [nzJustify]="'space-between'"
                            [nzAlign]="'center'"
                        >
                            <button nz-button nzType="default" nzSize="small">Отменить</button>
                            <button nz-button nzType="primary" nzSize="small">
                                <span nz-icon nzType="plus"></span> Добавить
                            </button>
                        </div>

                    </nz-card>
                </nz-dropdown-menu> -->
            </div>
            <div class="bi-semantic-select">

                <div
                    [ngStyle]="{
                        'display': 'flex',
                        'align-items': 'center',
                        'gap': '8px'
                    }"
                >
                    <div
                        [ngStyle]="{
                            'flex-grow': '1'
                        }"
                    >
                    <nz-select
                        nzShowSearch
                        nzPlaceHolder="Выберите слой"
                        nzSize="small"
                        style="width:100%;"
                    >
                        <nz-option nzLabel="Название слой данных 1" nzValue="1"></nz-option>
                        <nz-option nzLabel="Название слой данных 2" nzValue="2"></nz-option>
                        <nz-option nzLabel="Название слой данных 3" nzValue="3"></nz-option>
                    </nz-select>
                    </div>
                    <div>
                    <button
                        nz-button
                        nzNoAnimation
                        nz-dropdown
                        [nzDropdownMenu]="menu"
                        nzPlacement="bottomRight"
                        nzTrigger="click"
                        nzSize="small"
                    >
                        <span nz-icon nzType="plus" nzTheme="outline"></span> 
                    </button>
                    <nz-dropdown-menu #menu="nzDropdownMenu">
                        <nz-card
                            nz-menu
                            style="width:256px;"
                            nzSize="small"
                        >
                            <nz-form-control>
                                <nz-form-label nzFor="layer-name" nzSize="small"><strong>Название</strong></nz-form-label>
                                <input id="layer-name" nz-input placeholder="Название слоя" nzSize="small"/>
                            </nz-form-control>
                            <nz-divider [ngStyle]="{'margin': '8px 0'}"></nz-divider>
                            <div
                                nz-flex
                                [nzJustify]="'space-between'"
                                [nzAlign]="'center'"
                            >
                                <button nz-button nzType="default" nzSize="small">Отменить</button>
                                <button nz-button nzType="primary" nzSize="small">
                                    <span nz-icon nzType="plus"></span> Добавить
                                </button>
                            </div>
                        </nz-card>
                    </nz-dropdown-menu>
                    </div>
                </div>
                    
            </div>
            <div class="bi-semantic">
                <div class="bi-semantic-search">
                    <nz-input-group [nzSuffix]="suffixIconSearch" nzSize="small">
                        <input type="text" nz-input placeholder="Поиск в источнике"/>
                    </nz-input-group>
                    <ng-template #suffixIconSearch nzSize="small">
                        <span nz-icon nzType="search"></span>
                    </ng-template>
                </div>
                <div class="bi-semantic-list">
                    <nz-tree [nzData]="nodes" nzShowLine (nzClick)="nzEvent($event)"></nz-tree>
                </div>
            </div>
        </div>
        <div class="bi-metalayer-editor">

            <!-- Связи - начало -->
            <button
                (click)="showModalLink()"
                nz-button nzType="default" [nzSize]="'small'" nzShape="circle"
                nz-dropdown [nzDropdownMenu]="menu1"
            >
                <span nz-typography nzType="secondary">
                    <span nz-icon nzType="link"></span>
                </span>
            </button>
            <nz-dropdown-menu #menu1="nzDropdownMenu">
                <div nz-menu
                    style="
                        padding: 4px 8px;
                        display: flex;
                        grid-gap: 4px;
                    "
                >
                    <nz-tag style="margin: 0; border: 0;">trip.id_comp</nz-tag>
                    <nz-tag [nzColor]="'green'" style="margin: 0; border: 0;"><strong>1/N</strong></nz-tag>
                    <nz-tag style="margin: 0; border: 0;">pass_in_trip.date</nz-tag>
                </div>
            </nz-dropdown-menu>
            <!-- <br><br><br>
            <button
                nz-button nzType="default" [nzSize]="'small'" nzShape="circle"
                nz-popconfirm
                nzPopconfirmTitle="Are you sure delete this task?"
                nzPopconfirmPlacement="bottom"
                (nzOnConfirm)="confirm()"
                (nzOnCancel)="cancel()"
            >
                <span nz-typography nzType="danger">
                    <span nz-icon nzType="close"></span>
                </span>
            </button> -->



            <nz-modal
                (nzOnOk)="handleModalLinkOk()"
                (nzOnCancel)="handleModalLinkCancel()"
                [(nzVisible)]="isModalLinkVisible"
                nzCentered
                [nzStyle]="{
                    'max-width': '992px',
                    'width': '90%'
                }"
                nzTitle="Редактирования таблицы"
            >
                <ng-container *nzModalContent>

                    <form nz-form nzLayout="vertical">
                        <div class="bi-metarequests-editor" nz-row [nzGutter]="16">
                            <div nz-col class="gutter-row" [nzSpan]="6">
                                <nz-form-item>
                                    <nz-form-label nzFor="semname">Название</nz-form-label>
                                    <nz-form-control>
                                        <input nz-input name="semname" type="text" id="semname" placeholder="Название показателя"/>
                                    </nz-form-control>
                                </nz-form-item>
                                <nz-form-item>
                                    <nz-form-label nzFor="semcomment">Коментарий</nz-form-label>
                                    <nz-form-control >
                                        <textarea rows="2" nz-input name="semcomment" type="text" id="semcomment"></textarea>
                                    </nz-form-control>
                                </nz-form-item>
                            </div>
                            <div
                                nz-col class="gutter-row" [nzSpan]="18"
                                [ngStyle]="{
                                    'display': 'grid',
                                    'grid-template-rows': 'max-content 1fr'
                                }"
                            >
                                <nz-form-item [ngStyle]="{'margin-bottom':'unset'}">
                                    <nz-form-label nzFor="semexpression">Выражение</nz-form-label>
                                </nz-form-item>
                                <div>
                                    Здесь будет редактор
                                </div>
                            </div>
                        </div>
                        <nz-divider
                            style="font-size: 12px; font-weight: 500; color: #00000073;"
                            nzText="Предпросмотр"
                            nzOrientation="left"></nz-divider>
                        <div>
                            <nz-table
                                #basicTable
                                nzSize="small"
                            >
                                <thead>
                                  <tr>
                                    <th>Это</th>
                                    <th>Таблица</th>
                                    <th>Для</th>
                                    <th>Теста</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let data of basicTable.data">
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>
                                      <a>Action 一 </a>
                                      <nz-divider nzType="vertical"></nz-divider>
                                      <a>Delete</a>
                                    </td>
                                  </tr>
                                </tbody>
                            </nz-table>
                        </div>
                    </form>

                    <!-- <form nz-form>
                        <nz-form-item style="margin-bottom: 36px">
                            <nz-form-label [nzSpan]="7" nzFor="semname">Название</nz-form-label>
                            <nz-form-control [nzSpan]="15">
                                <input nz-input name="semname" type="text" id="semname" placeholder="Название показателя"/>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label [nzSpan]="7" nzFor="semlayer">Семантический слой</nz-form-label>
                            <nz-form-control [nzSpan]="15">
                                <nz-select name="semlayer" id="semlayer" nzShowSearch nzAllowClear nzPlaceHolder="Выберите семантический слой">
                                    <nz-option nzLabel="Jack" nzValue="jack"></nz-option>
                                    <nz-option nzLabel="Lucy" nzValue="lucy"></nz-option>
                                    <nz-option nzLabel="Tom" nzValue="tom"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label [nzSpan]="7" nzFor="semdatatype">Тип данных</nz-form-label>
                            <nz-form-control [nzSpan]="15">
                                <nz-select name="semdatatype" id="semdatatype" nzShowSearch nzAllowClear nzPlaceHolder="Выберите тип данных">
                                    <nz-option nzLabel="Такой" nzValue="jack"></nz-option>
                                    <nz-option nzLabel="Сякой" nzValue="lucy"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-form-item>
                            <nz-form-label [nzSpan]="7" nzFor="semшindextype">Тип показателя</nz-form-label>
                            <nz-form-control [nzSpan]="15">
                                <nz-select name="semшindextype" id="semшindextype" nzShowSearch nzAllowClear nzPlaceHolder="Выберите тип показателя">
                                    <nz-option nzLabel="Измерение" nzValue="one"></nz-option>
                                    <nz-option nzLabel="Мера" nzValue="two"></nz-option>
                                </nz-select>
                            </nz-form-control>
                        </nz-form-item>
                        <nz-divider
                            style="font-size: 12px; font-weight: 500; color: #00000073;"
                            nzText="Дополнительно"
                            nzOrientation="left"></nz-divider>
                        <nz-form-item>
                            <nz-form-label [nzSpan]="7" nzFor="semexpression">Выражение</nz-form-label>
                            <nz-form-control [nzSpan]="15">
                                <textarea rows="2" nz-input name="semexpression" type="text" id="semexpression"></textarea>
                            </nz-form-control>
                        </nz-form-item>
                    </form> -->
                </ng-container>
                <div *nzModalFooter [ngStyle]="{'display': 'flex'}">
                    <button nz-button nzType="default" [ngStyle]="{'margin-right': 'auto'}">
                        <span nz-icon nzType="reload" nzTheme="outline"></span>Обновить
                    </button>
                    <button nz-button nzType="default">Отменить</button>
                    <button nz-button nzType="primary">Применить</button>
                </div>
            </nz-modal>
            <!-- Связи - конец -->

        </div>
    </div>    
</nz-content>